{% extends 'gambit/base.html' %}
{% block title %}{{ submission.title }} - Submission - {% endblock %}
{% block content %}
<div class='panel panel-default'>
  <div class='panel-heading'>
    <h3 class='panel-title'><strong>{{ submission.title }}</strong></h3>
  </div>
  <div class='panel-body'>
    <p><strong>Submission date:</strong> <span title='{{ submission.submitted_on|date:'H:i O' }}'>{{ submission.submitted_on|date:'Y-m-d' }}</span></p>
    {% if submission.abstract %}<p><strong>Abstract:</strong> {{ submission.abstract|linebreaks }}{% endif %}</p>
    {% if submission.authors %}<p><strong>Author(s):</strong> {{ submission.authors|linebreaks }}</p>{% endif %}
    <p><strong>Contact Email:</strong> {{ submission.contact_email }}</p>
    {% if submission.file %}<p><strong>Submission:</strong> <a href='{{ submission.file.url }}'>{{ submission_file_name }} <span class='glyphicon glyphicon-download' aria-hidden='true'></span></a> ({{ submission.file.size|filesizeformat }})</p>{% endif %}
    {% if submission.conflicts %}<p><strong class='text-danger'>Conflicts:</strong> {{ submission.conflicts|linebreaks }}</p>{% endif %}
    {% if not user == submission.user %}{% if has_reviewed %}<a class='btn btn-primary' href='{% url 'update_review' review_uuid %}'>Edit your review</a>{% else %}<a class='btn btn-primary' href='{% url 'new_review' submission.uuid %}'>Submit a review</a>{% endif %}{% endif %}
    <hr>
    {% if user == submission.user %}<a class='btn btn-primary' href='{% url 'update_submission' submission.uuid %}'>Edit your submission</a>{% endif %}
  </div>
  {% load has_group %}{% if user.is_superuser or user|has_group:'Programme Committee' %}<table class='table table-striped table-responsive'>
    <thead>
      <th class='col-md-4'>Reviewer</th>
      <th class='col-md-3'>Expertise</th>
      <th class='col-md-3'>Score</th>
    </thead>
    <tbody>
      {% if user == submission.user %}<tr>
        <td colspan='3'>Reviews for your own submission have been hidden for the sake of impartiality.</td>
      </tr>{% else %}
      {% for review in reviews %}<tr>
        <td><strong>{% if review.user.profile.name %}{{ review.user.profile.name }}{% else %}{{ review.user.username }}{% endif %}</strong></a></td>
        <td>{{ review.expertise_score }}</td>
        <td>{{ review.submission_score }}</td>
      </tr>
      <tr>
        <td colspan='3'>{{ review.comments }}</td>
      </tr>{% empty %}
      <tr>
        <td colspan='3'>No reviews submitted yet!</td>
      </tr>{% endfor %}
      <thead>
        <th class='col-md-4'>Average Score</th>
        <th class='col-md-3'>Total Score</th>
        <th class='col-md-3'>Total Votes</th>
      </thead>
      <tr>
        <td><strong>{{ submission.get_average_score }}</strong></td>
        <td>{{ submission.get_total_score }}</td>
        <td>{{ submission.get_reviews|length }}</td>
      </tr>
    </tbody>
  </table>{% endif %}{% endif %}
</div>
{% endblock %}
